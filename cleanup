#!/bin/zsh

# =================================================================
# Next.js学習テンプレート - クリーンアップ実行スクリプト
# =================================================================
#
# このスクリプトはプロジェクトルートから tools/cleanup.zsh を
# 簡単に実行するためのラッパーです
#
# 使用方法:
#   ./cleanup           # インタラクティブモード
#   ./cleanup --force   # 強制実行（確認なし）
#   ./cleanup --dry-run # 削除対象ファイルを表示のみ
#
# 作成日: 2025-10-26
# =================================================================

set -euo pipefail

# プロジェクトルートディレクトリを検出
SCRIPT_DIR="$(cd "$(dirname "${(%):-%x}")" && pwd)"
PROJECT_ROOT="$SCRIPT_DIR"

# package.jsonの存在でプロジェクトルートを確認
if [[ ! -f "$PROJECT_ROOT/package.json" ]]; then
  echo "❌ エラー: Next.jsプロジェクトのルートディレクトリが見つかりません"
  echo "   このスクリプトはプロジェクトルートで実行してください"
  exit 1
fi

# cleanup.zshの存在確認
CLEANUP_SCRIPT="$PROJECT_ROOT/tools/cleanup.zsh"
if [[ ! -f "$CLEANUP_SCRIPT" ]]; then
  echo "❌ エラー: $CLEANUP_SCRIPT が見つかりません"
  echo "   tools/cleanup.zsh ファイルが存在することを確認してください"
  exit 1
fi

# 実行権限確認
if [[ ! -x "$CLEANUP_SCRIPT" ]]; then
  echo "🔧 cleanup.zshに実行権限を付与しています..."
  chmod +x "$CLEANUP_SCRIPT"
fi

# プロジェクトルートに移動してcleanup.zshを実行
cd "$PROJECT_ROOT"

echo "🚀 プロジェクトクリーンアップを開始します..."
echo "📁 プロジェクトルート: $PROJECT_ROOT"
echo ""

# 引数をそのままcleanup.zshに渡す
exec "./tools/cleanup.zsh" "$@"
